<clickhouse>
    <logger>
        <level>information</level>
        <console>1</console>
    </logger>

    <listen_host>0.0.0.0</listen_host>
    <max_connections>32</max_connections>
    <max_concurrent_queries>4</max_concurrent_queries>
    <max_server_memory_usage_to_ram_ratio>0.75</max_server_memory_usage_to_ram_ratio> 
    <mark_cache_size>1073741824</mark_cache_size>
    <uncompressed_cache_size>1073741824</uncompressed_cache_size> 

    <profiles>
        <default>
            <max_threads>6</max_threads>
            <max_block_size>65536</max_block_size>
            <max_memory_usage>1073741824</max_memory_usage> <!-- Limit per-query memory usage to 1GB -->
            <max_bytes_before_external_group_by>2147483648</max_bytes_before_external_group_by> 
            <max_bytes_before_external_sort>2147483648</max_bytes_before_external_sort> 
        </default>
    </profiles>

    <storage_configuration>
        <disks>
            <!-- S3 disk pointing to the MinIO service -->
            <s3>
                <type>object_storage</type>
                <object_storage_type>s3</object_storage_type>
                <metadata_type>local</metadata_type>
                <endpoint>http://da-zoomcamp.minio.local:9000</endpoint>
                <access_key_id>root</access_key_id>
                <secret_access_key>da-zoomcamp</secret_access_key>
                <metadata_path>/var/lib/clickhouse/disks/s3/</metadata_path>
            </s3>
            <!-- Local cache for the S3 disk to improve performance -->
            <s3_cache>
                <type>cache</type>
                <disk>s3</disk>
                <path>/var/lib/clickhouse/disks/s3_cache/</path>
                <max_size>10Gi</max_size>
            </s3_cache>
        </disks>
    </storage_configuration>

</clickhouse>
